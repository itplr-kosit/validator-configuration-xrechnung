<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." name="abu-semox" default="provide-semox">

  <!-- 
  Provides SeMox dependency either from most mature release destination 
  or from local build based Deployment:
    * 
   -->

  <property name="semox.major.version" value="1" />
  <property name="semox.minor.version" value="0" />

  <property name="semox.version"
    value="${semox.major.version}.${semox.minor.version}.0-rc1" />

  <property name="semox.zip.name" value="semox-${semox.version}.zip" />

  <!-- Directory of installed (aka provided) semox  -->
  <property name="semox.home" location="${lib.dir}/semox-${semox.version}" />

  <property name="semo.xsd" location="${semox.home}/xsd/semo.xsd" />
  <property name="semox.lib.dir" location="${semox.home}/lib" />


  <target name="init">
    <echo message="Calling ${ant.project.name} init task (from ${ant.file})" />
    <!-- property defining the local directory containing the semox distribution zip-->
    <fail message="Property 'semox.dist.dir'
 is not set." unless="semox.dist.dir" />
  </target>


  <target name="dependency-resolve-local" depends="init">
    <!--    <property name="semox.dist.dir" location="${basedir}/../semox/dist" />-->
    <!-- directly unzip from semox as parent dist  -->
    <unzip src="${semox.dist.dir}/${semox.zip.name}" dest="${semox.home}"
      failonemptyarchive="true">
      <cutdirsmapper dirs="1" />
    </unzip>
  </target>

  <target name="provide-semox" depends="dependency-resolve-local" />

  <target name="check-validation-requirements" depends="init">
    <length string="${model.file}" when="le" length="0" property="t" />
    <echo message="t=${t}" />

    <fail message="Property 'model.file'
 is not set." unless="model.file" />

    <fail message="SeMoX model not available at ${model.file}">
      <condition>
        <or>
          <length string="${model.file}" when="equal" length="0" />
          <not>
            <available file="${model.file}" type="file" />
          </not>
        </or>
      </condition>

    </fail>

    <fail message="Property 'semo.xsd'
 is not set." unless="semo.xsd" />

    <fail message="SeMoX XSD not available at ${semo.xsd}">
      <condition>
        <not>
          <available file="${semo.xsd}" type="file" />
        </not>
      </condition>
    </fail>
  </target>

  <target name="validate-model" depends="check-validation-requirements"
    description="Validating a SeMoX model">
    <echo message="Validating ${model.file} with ${semo.xsd}" />
    <!-- TODO:  have to check of model file exists , cause schemavalidate won't complain otherwise-->
    <schemavalidate fullchecking="true" failonerror="true" warn="true">
      <schema namespace="http://semo-xml.org/2025/model" file="${semo.xsd}" />
      <fileset file="${model.file}" />
    </schemavalidate>
  </target>


</project>
